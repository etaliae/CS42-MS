{% extends 'base.html' %}
{% load static %}

{% block title %}
Dashboard
{% endblock %}

{% block headImports %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

{% endblock %}

{% block content %}

<body 
    style=
    "background: linear-gradient(180deg,  #172554 0%, #1E40AF 100%);
    color: #FFF;
    font-family: Inter;">
    <div class="container vh-100">
        <div class="row" style="gap: 1%; height: 95%;">
        <!--Left half of the page-->
            <div class="col-7" 
                style="
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                gap: 1%;">
                <!--Welcome panel-->
                <div class="row">
                    <div class="col" 
                        style="
                        display: flex;
                        padding: 30px 32px;
                        justify-content: space-between;
                        align-items: flex-end;
                        border-radius: 45px;
                        border: 2px solid #EFF6FF;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);">
                        <h1 style="color: #fff;
                            font-size: 72px;
                            font-style: normal;
                            font-weight: 500;
                            line-height: 90px;
                            letter-spacing: -1.44px;">
                                Welcome, 
                                <br>
                                <b>{{ user.username }}!</b>
                        </h1>
                        <img src="{% static 'Clipboard.png' %}" 
                            style="
                            width: 133px;
                            height: 165px;">
                    </div>
                </div>
                <!--QPI by semester-->
                <div class="row" 
                    style="
                    display: flex;
                    gap: 1%;
                    flex-wrap: nowrap;
                    flex-direction: row;
                    height: 100%;">
                    <div class="col-8" 
                        style="
                        display: flex;
                        flex-direction: column;
                        gap: 2%;
                        align-content: stretch;">
                        <div class="row">
                            <div class="col" 
                                style="
                                display: flex;
                                flex-direction: column;
                                padding: 30px 32px;
                                justify-content: space-between;
                                align-items: flex-start;
                                border-radius: 45px;
                                border: 2px solid #EFF6FF;
                                box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                                backdrop-filter: blur(36.45000076293945px);">
                            
                                    <h2>QPI by Semester</h2>
                                    <br>
                                    <canvas id="qpiBySem">
                                    </canvas>

                                    <script>
                                        let semester = JSON.parse('{{ semester|safe }}');
                                        let qpi = JSON.parse('{{ qpi|safe }}');


                                        let a = document.getElementById('qpiBySem').getContext('2d');
                                        let qpiBySem = new Chart(a, {
                                            type: 'line',
                                            data: {
                                                labels: semester,
                                                datasets: [
                                                    {
                                                        label: 'QPI',
                                                        data: qpi,
                                                        fill: false,
                                                        borderColor: 'rgb(75, 192, 192)',
                                                        tension: 0.3
                                                    },
                                                ]
                                            },
                                            options: {
                                                plugins: {
                                                    legend: {
                                                        display: false
                                                    }
                                                }
                                            }
                                        });
                                    </script>
                            </div>
                        </div>
                    </div>
                    <div class="col" 
                            style="
                            padding: 30px 32px;
                            border-radius: 45px;
                            border: 2px solid #EFF6FF;
                            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                            backdrop-filter: blur(36.45000076293945px);">
                            <div id="output_ctr">

                                <h3>Cumulative QPI</h3>
                                <span id="highest" 
                                    style = "
                                    font-size: 36px;
                                    font-style: normal;
                                    font-weight: 700;
                                    line-height: normal;">
                                    {{ cumulative_qpi }}
                                </span><br><br>
                                <h3>Semestral QPI</h3>
                                <span id="highest" 
                                    style = "
                                    font-size: 36px;
                                    font-style: normal;
                                    font-weight: 700;
                                    line-height: normal;">
                                    {{ latest_qpi }}
                                </span><br><br>
                            </div>
                        </div>

                </div>
                <!--View grades-->
                <div class="row"
                    style = "justify-content: flex-end;">
                    <div class="col-6" 
                        style="
                        display: flex;
                        padding: 26px 26px;
                        align-items: flex-end;
                        border-radius: 45px;
                        flex-direction: row-reverse;
                        justify-content: space-between;
                        border: 6px solid #121471;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);
                        flex-wrap: nowrap;">
                            <img src="{% static 'Hands.png' %}" style="width: 120px;">
                            <a href="{% url 'dashboard:grades-list' %}" 
                            style="
                            color: #FFF;
                            text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
                            font-size: 44px;
                            font-style: normal;
                            font-weight: 700;
                            text-decoration: none;
                            line-height: normal;">
                                View Grades
                            </a>
                    </div>
                </div>
                <div class="row" 
                    style="
                    display: flex;
                    flex-direction: row;
                    flex-wrap: nowrap;
                    gap: 0.5%;">
                    <div class="col-6" 
                        style="
                        display: flex;
                        padding: 26px 26px;
                        justify-content: space-between;
                        align-items: flex-end;
                        border-radius: 45px;
                        border: 6px solid #121471;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);">
                            <img src="{% static 'Calendar.png' %}" style="width: 120px;">
                        <a href="{% url 'schedo:landing' %}" 
                        style="
                        color: #FFF;
                        text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
                        font-size: 44px;
                        font-style: normal;
                        font-weight: 700;
                        text-decoration: none;
                        line-height: normal;">Schedo</a>
                    </div>
                    <div class="col-6" 
                        style="
                        display: flex;
                        padding: 26px 26px;
                        justify-content: space-between;
                        align-items: flex-end;
                        border-radius: 45px;
                        border: 6px solid #121471;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);">
                            <img src="{% static 'VizProf.png' %}" 
                            style="
                            width: 120px;
                            height: 120px;">
                        <a href="{% url 'profs_to_pick:vizprof-search' %}" style="
                        color: #FFF;
                        text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
                        font-size: 44px;
                        font-style: normal;
                        font-weight: 700;
                        text-decoration: none;
                        line-height: normal;">
                            VizProf
                        </a>
                    </div>
                </div>
            </div>
        <!--Right half of the page-->
        <div class="col-4" 
            style="
            display: flex;
            width: 497px;
            gap: 2%;
            flex-direction: column;">
                <div class="row" 
                    style="
                    flex: 1;
                    display: flex;
                    flex-wrap: nowrap;
                    gap: 1%;">
                    <!--Latin Honors and IPS Progress-->
                    <div class="col-6" 
                        style="
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        gap: 1%;">
                        <div class="row" 
                            style="
                            flex: 1;
                            margin-top: 2%;
                            padding: 30px 30px;
                            border-radius: 45px;
                            border: 2px solid #EFF6FF;
                            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                            backdrop-filter: blur(36.45000076293945px);">

                            <!--Latin Honors Eligibility-->
                            <div class="latin_honors_eligibility">

                                <h2>Latin Honors Eligibility</h2>

                                <form id="input_form" method="post">
                                    {% csrf_token %}

                                    <p>How many are your computable units left?</p>
                                    <input type="number" id="remaining_units" name="remaining_units" value="0"
                                    style = "width: 50%;">
                                    <p>Check Eligibility</p>
                                    <select id="honor" name="honor">
                                        <option value="Honorable Mention">Honorable Mention</option>
                                        <option value="Cum Laude">Cum Laude</option>
                                        <option value="Magna Cum Laude">Magna Cum Laude</option>
                                        <option value="Summa Cum Laude">Summa Cum Laude</option>
                                    </select><br><br>

                                    <input type="submit" value="Submit">
                                </form>

                                {% comment %}
                                <script>
                                    $(document).ready(function () {
                                        $('#input_form').submit(function (e) {
                                            e.preventDefault();
                                            var remaining_units = $('#remaining_units').val();

                                            console.log("Remaining Units:", remaining_units);

                                            $.ajax({
                                                type: 'POST',
                                                url: '',
                                                data: {
                                                    remaining_units: remaining_units,
                                                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                                                },
                                                success: function (data) {
                                                    // Log the response data to the console
                                                    console.log("Response Data:", data);

                                                    if (data.remaining_units !== undefined) {
                                                        // Update the value of the span element with the id 'result1'
                                                        $('#remaining').text(data.remaining_units);
                                                    } else {
                                                        console.error("Error: No 'remaining_units' found in response data.");
                                                    }
                                                },
                                                error: function (xhr, status, error) {
                                                    // Log any errors to the console
                                                    console.error("AJAX Error:", error);
                                                }
                                            });
                                        });
                                    });
                                </script>

                                {% endcomment %}
                            </div>
                            
                        </div>
                        <div class="row" 
                            style="
                            padding: 30px 32px;
                            border-radius: 45px;
                            border: 2px solid #EFF6FF;
                            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                            backdrop-filter: blur(36.45000076293945px);">
                            <div id="output_ctr">

                                <h3>IPS Progress</h3>
                                <strong><span id="progress">{{ ips_progress }}%</span></strong>
                                <p>
                                    You're making excellent progress!
                                    <span id="completed">{{ completed_units }}</span> units down,
                                    <span id="remaining">{{ remaining_units }}</span> more units to go!
                                </p>
                            </div>
                        </div>
                    </div>
                    <!--Honorable Mention-->
                    <div class="col-6" 
                        style="
                        padding: 30px 32px;
                        border-radius: 45px;
                        border: 2px solid #EFF6FF;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);">
                        <div id="output_ctr">
                            <h3 style = "
                                font-size: 36px;
                                font-style: normal;
                                font-weight: 700;
                                line-height: normal;">
                                <span id="honor_chosen">
                                    {{ honor }}
                                </span> is ... <br>
                            </h3>
                            <img src="{% static 'Rocket.png' %}" 
                                style="
                                width: 140px;">
                            <strong><span id="eligibility">{{ eligibility_text }}</span></strong>
                            <p>
                                To achieve this,
                                get a minimum QPI of <span id="minimum">{{ minimum_required }}</span>
                                on your remaining <span id="remaining">{{ remaining_units }}</span> units.
                            </p>
                            <p>
                                Highest Attainable: 
                                <span id="highest" 
                                    style = "
                                    font-size: 36px;
                                    font-style: normal;
                                    font-weight: 700;
                                    line-height: normal;">
                                    {{ highest_possible }}
                                </span><br><br>
                                Honor Range: 
                                <span id="honor_min" 
                                    style = "
                                    font-size: 36px;
                                    font-style: normal;
                                    font-weight: 700;
                                    line-height: normal;">
                                    {{ honor_min }}
                                </span> <br>
                                    to 
                                <br> <span id="honor_max" 
                                    style = "
                                    font-size: 36px;
                                    font-style: normal;
                                    font-weight: 700;
                                    line-height: normal;">
                                    {{ honor_max }}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row" style="align-self: stretch;">
                    <!-- <div class="grades-table table" style = "
                    padding: 31px 36px;
                    border-radius: 45px;
                    border: 2px solid #EFF6FF;
                    box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                    backdrop-filter: blur(36.45000076293945px);
                    align-self: stretch;">
                    <table>
                
                        <tr>
                            {% for column in df.columns %}
                            <th>{{ column }}</th>
                            {% endfor %}
                        </tr>
                
                        {% for row in df.values %}
                        <tr>
                            {% for value in row %}
                            <td>{{ value }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                
                    </table> -->
                    <div style="
                        display:flex;
                        flex-direction: row;
                        padding: 30px 32px;
                        border-radius: 45px;
                        border: 2px solid #EFF6FF;
                        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
                        backdrop-filter: blur(36.45000076293945px);
                        align-self: stretch;">

                        <h3 style="align-self: center;">
                            Cumulative Letter Grade Frequency
                        </h3>
                        <div style="
                            width:fit-content;
                            height: fit-content;">

                            <canvas id="letterFreq" width="200" height="50">
                            </canvas>

                            <script>
                                let final_grade = JSON.parse('{{ final_grade|safe }}');
                                let subject_code = JSON.parse('{{ subject_code|safe }}');

                                let b = document.getElementById('letterFreq').getContext('2d');
                                let letterFreq = new Chart(b, {
                                    type: 'doughnut',
                                    data: {
                                        labels: final_grade,
                                        datasets: [
                                            {
                                                label: 'Subject Code',
                                                data: subject_code,
                                                backgroundColor: [
                                                    '#073376',
                                                    '#046E94',
                                                    '#29B2A0',
                                                    '#FFCC33',
                                                    '#F3D643',
                                                    '#FFAE42',
                                                    '#C36721'
                                                ],
                                                hoverOffset: 4
                                            },
                                        ]
                                    },
                                    options: {
                                        plugins: {
                                            legend: {
                                                display: false
                                            }
                                        }
                                    }
                                });
                            </script>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<!--Latest Semestral QPI-->

<!-- <div class="latest_qpi">
    <h2>Latest Semestral QPI</h2>
    <p>{{ latest_qpi }}</p>
</div> -->

<!--Dean's Lister Award-->

<!-- <div class="dean_list">
    <h2>Dean's Lister Award</h2>
    <p>{{ dean_list }}</p>
</div> -->





{% endblock %}